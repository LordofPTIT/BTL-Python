<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cảnh Báo Lừa Đảo! - VN Phishing Guard Pro</title>
    <style>
        :root { --danger-color: #cf222e; --danger-bg: #ffeef0; --success-color: #2da44e; --success-bg: #e6ffed; --warning-color: #9a6700; --warning-bg: #fff8c5; --text-color: #24292f; --secondary-text-color: #57606a; --border-color: #d0d7de; --bg-color: #f6f8fa; --link-color: #0969da; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--danger-bg); color: var(--text-color); margin: 0; padding: 30px; display: flex; justify-content: center; align-items: center; min-height: 90vh; }
        .container { background-color: #ffffff; border: 1px solid var(--danger-color); border-radius: 8px; padding: 30px 40px; max-width: 650px; margin: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; }
        .icon-container { margin-bottom: 20px; }
        .warning-icon { font-size: 4em; color: var(--danger-color); display: inline-block; animation: pulse 1.5s infinite ease-in-out; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        h1 { color: var(--danger-color); margin-top: 0; margin-bottom: 15px; font-size: 1.8em; font-weight: 600; }
        p { font-size: 1.05em; line-height: 1.6; margin-bottom: 15px; color: var(--secondary-text-color); }
        p.lead { font-size: 1.15em; color: var(--text-color); margin-bottom: 25px; }
        .details { background-color: #f6f8fa; border: 1px solid var(--border-color); border-radius: 6px; padding: 15px; margin-bottom: 25px; text-align: left; }
        .details strong { color: var(--text-color); display: inline-block; min-width: 100px; }
        .url-display, .domain-display, .reason-display { word-wrap: break-word; font-family: monospace; font-size: 0.95em; margin-bottom: 8px; }
        .domain-display { color: var(--danger-color); font-weight: bold; }
        .reason-display { font-style: italic; color: var(--secondary-text-color); }
        .buttons { margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .buttons button { padding: 10px 20px; border: 1px solid transparent; border-radius: 6px; cursor: pointer; font-size: 1em; font-weight: 500; transition: background-color 0.2s ease, border-color 0.2s ease; min-width: 150px; }
        #back-button { background-color: var(--success-color); color: white; border-color: rgba(27, 31, 36, 0.15); }
        #back-button:hover { background-color: #2c974b; }
        #proceed-button { background-color: var(--danger-color); color: white; border-color: rgba(27, 31, 36, 0.15); }
        #proceed-button:hover { background-color: #a40e26; }
        #report-false-positive-button { background-color: var(--warning-bg); color: var(--warning-color); border-color: #eac54f; }
        #report-false-positive-button:hover { background-color: #f4e086; }
        #report-false-positive-button:disabled { opacity: 0.6; cursor: not-allowed; }
        #report-status { margin-top: 15px; font-weight: 500; height: 1.2em; } /* Reserve space */
        .success { color: var(--success-color); }
        .error { color: var(--danger-color); }
    </style>
</head>
<body>
    <div class="container">
        <div class="icon-container"><span class="warning-icon">⚠️</span></div>
        <h1>Cảnh Báo Lừa Đảo Tiềm Ẩn!</h1>
        <p class="lead">Tiện ích <strong>VN Phishing Guard Pro</strong> đã xác định trang bạn đang cố truy cập có thể không an toàn.</p>

        <div class="details">
            <p><strong>URL Bị Chặn:</strong> <span class="url-display" id="phishing-url">Đang tải...</span></p>
            <p><strong>Tên miền:</strong> <span class="domain-display" id="phishing-domain">...</span></p>
            <p><strong>Lý do:</strong> <span class="reason-display" id="phishing-reason">Đang tải...</span></p>
        </div>

        <p>Việc tiếp tục truy cập có thể dẫn đến rủi ro bị đánh cắp thông tin cá nhân, tài khoản hoặc lây nhiễm mã độc. **Chúng tôi thực sự khuyên bạn nên quay lại.**</p>

        <div class="buttons">
            <button id="back-button">⬅️ Quay Lại An Toàn</button>
            <button id="proceed-button">Tiếp Tục (Rủi Ro) ➡️</button>
            <button id="report-false-positive-button">Đây là trang an toàn?</button>
        </div>
         <p id="report-status"></p>
    </div>

    <script>
        // Lấy tham số từ URL trang cảnh báo
        const urlParams = new URLSearchParams(window.location.search);
        const blockedUrl = decodeURIComponent(urlParams.get('url') || '');
        const blockedDomain = decodeURIComponent(urlParams.get('domain') || '');
        const reason = decodeURIComponent(urlParams.get('reason') || 'Nằm trong danh sách chặn.');

        // Ánh xạ element
        const urlDisplay = document.getElementById('phishing-url');
        const domainDisplay = document.getElementById('phishing-domain');
        const reasonDisplay = document.getElementById('phishing-reason');
        const backButton = document.getElementById('back-button');
        const proceedButton = document.getElementById('proceed-button');
        const reportFalsePositiveButton = document.getElementById('report-false-positive-button');
        const reportStatus = document.getElementById('report-status');

        // Hiển thị thông tin
        urlDisplay.textContent = blockedUrl || "Không xác định";
        domainDisplay.textContent = blockedDomain || "Không xác định";
        reasonDisplay.textContent = reason;

        // Vô hiệu hóa nút nếu không có URL/Domain
        if (!blockedUrl || !blockedDomain) {
             proceedButton.disabled = true;
             reportFalsePositiveButton.disabled = true;
        }

        // Xử lý nút bấm
        proceedButton.onclick = () => { if(blockedUrl) window.location.href = blockedUrl; };
        backButton.onclick = () => { if (window.history.length > 1) window.history.back(); else window.close(); };

        // Xử lý báo cáo sai
         reportFalsePositiveButton.onclick = () => {
             if(blockedDomain && chrome.runtime && chrome.runtime.sendMessage) {
                 reportStatus.textContent = 'Đang gửi báo cáo...'; reportStatus.className='';
                 reportFalsePositiveButton.disabled = true; // Disable trong khi gửi
                 proceedButton.disabled = true; // Disable cả nút tiếp tục

                 chrome.runtime.sendMessage(
                     { action: 'reportItem', type: 'false_positive_domain', value: blockedDomain, context: `False positive report from warning page for URL: ${blockedUrl}` },
                     (response) => {
                          if (chrome.runtime.lastError) {
                              console.error("Warning page: Error reporting false positive:", chrome.runtime.lastError);
                               reportStatus.textContent = 'Lỗi: Không thể gửi báo cáo.'; reportStatus.className = 'error';
                               reportFalsePositiveButton.disabled = false; proceedButton.disabled = false; // Re-enable
                          } else if (response && response.success) {
                               reportStatus.textContent = 'Cảm ơn! Báo cáo của bạn đã được gửi để xem xét.'; reportStatus.className = 'success';
                               // Giữ nút bị vô hiệu hóa sau khi gửi thành công
                          } else {
                               reportStatus.textContent = `Lỗi: ${response?.message || 'Không thể gửi báo cáo.'}`; reportStatus.className = 'error';
                               reportFalsePositiveButton.disabled = false; proceedButton.disabled = false; // Re-enable
                          }
                     }
                 );
             } else {
                 reportStatus.textContent = 'Lỗi: Không thể gửi báo cáo từ trang này.'; reportStatus.className = 'error';
             }
         };
    </script>
</body>
</html>